<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema La Vie Bella</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffd1dc">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Arial;background:#f6f6f6;margin:0}
header{background:#ffd1dc;padding:20px;text-align:center;font-size:22px;font-weight:bold}
.menu{display:grid;grid-template-columns:1fr 1fr;gap:15px;padding:20px}
.menu button{background:#ffc0cb;border:none;padding:20px;font-size:18px;border-radius:12px;cursor:pointer}
.section{display:none;background:#fff;margin:20px;padding:20px;border-radius:12px}
input,textarea{width:100%;padding:10px;margin:8px 0}
.actions button{margin-right:10px;padding:10px 18px;background:#ffc0cb;border:none;border-radius:8px;cursor:pointer}
.list{margin-top:20px;border-top:1px solid #ccc}
.item{padding:10px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
.item span{cursor:pointer}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal-content{background:#fff;padding:20px;border-radius:12px;width:520px;max-height:90vh;overflow:auto}
img{max-width:100%;margin-top:8px;border-radius:6px}
.search{margin-bottom:10px}
.small{font-size:12px;color:#555}
.login{max-width:360px;margin:120px auto;background:#fff;padding:25px;border-radius:14px}
.login button{width:100%}
.logout{position:absolute;right:20px;top:20px;font-size:14px;cursor:pointer}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="loginBox">
<h2>Login</h2>
<input id="email" placeholder="E-mail">
<input id="senha" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>

<!-- SISTEMA -->
<div id="app" style="display:none">

<header>
Sistema La Vie Bella
<span class="logout" onclick="logout()">Sair</span>
</header>

<div class="menu">
<button onclick="openModule('instagram_feed')">Instagram Feed</button>
<button onclick="openModule('instagram_stories')">Instagram Stories</button>
<button onclick="openModule('facebook')">Facebook</button>
<button onclick="openModule('tiktok')">TikTok</button>
<button onclick="openModule('shopee')">Shopee</button>
<button onclick="openModule('whatsapp')">WhatsApp</button>
<button onclick="openModule('postados')">Postados</button>
</div>

<div class="section" id="instagram_feed">
<h2>Instagram Feed</h2>
<input id="ig_feed_nome" placeholder="Nome do produto">
<textarea id="ig_feed_desc" placeholder="Descrição"></textarea>
<input type="file" id="ig_feed_fotos" multiple>
<div class="actions">
<button onclick="saveItem('ig_feed')">Salvar</button>
<button onclick="clearForm('ig_feed')">Limpar</button>
</div>
<div class="list" id="list_ig_feed"></div>
<button onclick="back()">Voltar</button>
</div>

<div class="section" id="instagram_stories">
<h2>Instagram Stories</h2>
<input id="ig_stories_nome" placeholder="Nome do produto">
<input type="file" id="ig_stories_fotos" multiple>
<div class="actions">
<button onclick="saveItem('ig_stories')">Salvar</button>
<button onclick="clearForm('ig_stories')">Limpar</button>
</div>
<div class="list" id="list_ig_stories"></div>
<button onclick="back()">Voltar</button>
</div>

<div class="section" id="facebook"><h2>Facebook</h2><div id="facebook_form"></div></div>
<div class="section" id="tiktok"><h2>TikTok</h2><div id="tiktok_form"></div></div>
<div class="section" id="shopee"><h2>Shopee</h2><div id="shopee_form"></div></div>
<div class="section" id="whatsapp"><h2>WhatsApp</h2><div id="whatsapp_form"></div></div>

<div class="section" id="postados">
<h2>Postados</h2>
<input class="search" placeholder="Buscar..." oninput="searchPostados(this.value)">
<div class="list" id="list_postados"></div>
<button onclick="back()">Voltar</button>
</div>

<div class="modal" id="modal">
<div class="modal-content">
<h3 id="m_nome"></h3>
<textarea id="m_desc" readonly></textarea>
<div id="m_fotos"></div>
<div class="actions">
<button onclick="deleteItem()">Excluir</button>
<button onclick="closeModal()">Fechar</button>
</div>
</div>
</div>

</div>

<script>
const supabase = supabaseJs.createClient(
  "https://ksmbmldjtfgtrbozmdmw.supabase.co",
  "sb_publishable_dlxA713pDtE3VGGaG-0GJg_FsdanUYy"
)

let user=null
let db={}

async function login(){
const {data,error}=await supabase.auth.signInWithPassword({
email:email.value,password:senha.value
})
if(error){alert("Login inválido");return}
user=data.user
start()
}

async function logout(){
await supabase.auth.signOut()
location.reload()
}

async function start(){
loginBox.style.display="none"
app.style.display="block"
loadDB()
}

async function loadDB(){
let {data}=await supabase.from("dados").select("*").eq("uid",user.id)
if(data.length){
db=data[0].conteudo
}else{
db={ig_feed:[],ig_stories:[],facebook:[],tiktok:[],shopee:[],whatsapp:[],postados:[]}
await save()
}
render()
}

async function save(){
await supabase.from("dados").upsert({
uid:user.id,
conteudo:db
})
render()
}

/* ===== SISTEMA ORIGINAL (INALTERADO) ===== */

let current=null

function openModule(id){
document.querySelectorAll('.section').forEach(s=>s.style.display='none')
document.getElementById(id).style.display='block'
render()
}
function back(){document.querySelectorAll('.section').forEach(s=>s.style.display='none')}

function createForm(id){
return `
<input id="${id}_nome" placeholder="Nome do produto">
<textarea id="${id}_desc" placeholder="Descrição"></textarea>
<input type="file" id="${id}_fotos" multiple>
<div class="actions">
<button onclick="saveItem('${id}')">Salvar</button>
<button onclick="clearForm('${id}')">Limpar</button>
</div>
<div class="list" id="list_${id}"></div>
<button onclick="back()">Voltar</button>`
}

['facebook','tiktok','shopee','whatsapp'].forEach(m=>{
document.getElementById(m+'_form').innerHTML=createForm(m)
})

function saveItem(k){
let nome=document.getElementById(k+'_nome').value
if(!nome) return
let descEl=document.getElementById(k+'_desc')
let desc=descEl?descEl.value:''
let fotos=[]
db[k].push({nome,desc,fotos})
save()
clearForm(k)
}

function clearForm(k){
['nome','desc','fotos'].forEach(f=>{
let el=document.getElementById(k+'_'+f)
if(el) el.value=''
})
}

function render(){
Object.keys(db).forEach(k=>{
let el=document.getElementById('list_'+k)
if(!el) return
el.innerHTML=''
let items=k==='postados'
?[...db.postados].sort((a,b)=>new Date(b.data)-new Date(a.data))
:db[k]
items.forEach((it,i)=>{
el.innerHTML+=`
<div class="item">
<span onclick="openItem('${k}',${i})">${it.nome}</span>
<div>
${k!=='postados'
?`<button onclick="toPostados('${k}',${i})">Postar</button>
<button onclick="removeDirect('${k}',${i})">Excluir</button>`
:`<div class="small">${it.origem} • ${it.data}</div>
<button onclick="openItem('postados',${i})">Visualizar</button>
<button onclick="removeDirect('postados',${i})">Excluir</button>`}
</div></div>`
})
})
}

function openItem(k,i){
current={k,i}
let it=db[k][i]
m_nome.innerText=it.nome
m_desc.value=it.desc||''
m_fotos.innerHTML=''
modal.style.display='flex'
}

function deleteItem(){
db[current.k].splice(current.i,1)
save()
closeModal()
}
function removeDirect(k,i){db[k].splice(i,1);save()}
function toPostados(k,i){
let it=db[k][i]
db.postados.push({...it,origem:k,data:new Date().toLocaleString()})
db[k].splice(i,1)
save()
}
function searchPostados(v){
[...list_postados.children].forEach(i=>{
i.style.display=i.innerText.toLowerCase().includes(v.toLowerCase())?'flex':'none'
})
}
function closeModal(){modal.style.display='none'}
</script>

<!-- SUPABASE AUTH + SYNC FINAL -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://ksmbmldjtfgtrbozmdmw.supabase.co";
const SUPABASE_KEY = "SUA_PUBLISHABLE_KEY_AQUI";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

// LOGIN
async function login(email, senha) {
  const { error } = await supabaseClient.auth.signInWithPassword({
    email,
    password: senha
  });

  if (error) {
    alert(error.message);
  } else {
    alert("Login realizado com sucesso");
    sincronizarNuvem();
  }
}

// SALVAR LOCAL + NUVEM
async function backupNuvem() {
  const { data: { user } } = await supabaseClient.auth.getUser();
  if (!user) return;

  await supabaseClient
    .from("dados")
    .upsert({
      uid: user.id,
      conteudo: db
    });
}

// RESTAURAR DA NUVEM
async function sincronizarNuvem() {
  const { data: { user } } = await supabaseClient.auth.getUser();
  if (!user) return;

  const { data } = await supabaseClient
    .from("dados")
    .select("conteudo")
    .eq("uid", user.id)
    .single();

  if (data && data.conteudo) {
    localStorage.setItem("db", JSON.stringify(data.conteudo));
    location.reload();
  }
}

// GANCHO AUTOMÁTICO
const _saveOriginal = save;
save = function () {
  _saveOriginal();
  backupNuvem();
};
</script>


</body>
</html>
